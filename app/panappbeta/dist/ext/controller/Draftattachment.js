sap.ui.define(["sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/UIComponent"],function(e,t,n,a){"use strict";function o(n,a){var o;function r(e){o&&o.getBeginButton().setEnabled(e)}function i(e){o.setBusy(e)}function s(){o&&o.close()}function l(t,n,a){e.error("Upload failed",{title:"Error"})}function c(e){return sap.ui.core.Fragment.byId("excelUploadDialog",e)}return{onFileUploadDone:function(e){},onBeforeOpen:function(e){o=e.getSource();n.addDependent(o)},onAfterClose:function(e){n.removeDependent(o);o.destroy();o=undefined},onAfterBinding:async function(e){const t=this.base.getExtensionAPI();oModel=t.getModel();sFunctionName="getattachments";oFunction=oModel.bindContext(`/${sFunctionName}(...)`)},_getBaseURL:function(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id").replaceAll(".","/");return jQuery.sap.getModulePath(e)},onFileChange:function(e){var t=e.getParameters("files").files[0];this.file=t},onFileUploadDone:function(e){},onOk:function(e){let t=e.oSource.oPropagatedProperties.oModels.pageInternal.mContexts["/pages/panappbeta::tab1ObjectPage/controls/fe::table::tab1tovendor_data::LineItem::VendorData"].oModel.oData.currentCtxt.sPath;const n=/PAN_Number='([^']+)'/;const a=t.match(n);const o=a[1];var r=c("__fileUploader");let i=e.oSource;var s=new FileReader;s.onload=function(e){var t=this.file;this.content=e.currentTarget.result;this.createfile(o,i)}.bind(this);s.readAsDataURL(this.file)},createfile:async function(t,n){var a=this;var t=t;var o=this.file;var r={PAN_Number:t,contentS:this.content,mediaType:this.file.type,fileName:this.file.name};let i=n.getParent().getParent().getParent().oContainer.getParent().getParent().getParent().getManifestObject()._oBaseUri._string;var l={url:i+"odata/v4/catalog/attachments",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(r)};const c=async()=>{var t=new sap.m.BusyDialog({text:"Uploading file..."});t.open();return new Promise((a,o)=>{$.ajax(l).done(async(o,r,i)=>{var s=r;if(s=="success"){t.close();var l="FILE UPLOADED SUCCESSFULLY";e.success(l)}else{var c="ERROR UPLOADING THE FILE";e.error(c)}a(o.ID);let f=n;if(n.getParent().getBindingContext()!=undefined){await n.getParent().getBindingContext().refresh()}else{}}).fail(e=>{o(e)})})};await c();s()},onCancel:function(e){s()},onTypeMismatch:function(e){var t=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");l("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+t)},onFileAllowed:function(e){r(true)},onFileEmpty:function(e){r(false)},onUploadComplete:function(e){var a=e.getParameter("status");var o=e.getSource();o.clear();r(false);i(false);if(a>=400){var c;try{c=JSON.parse(e.getParameter("responseRaw"))}catch(t){c=e.getParameter("responseRaw")}if(c&&c.error&&c.error.message){l(c.error.code,c.error.target,c&&c.error&&c.error.message)}}else{t.show("File uploaded successfully");n.refresh();s()}}}}return{upload:function(e,t){this.loadFragment({id:"excelUploadDialog",name:"panappbeta.ext.fragment.Draftattachment",controller:o(this,"MediaFile")}).then(function(e){e.open()})}}});